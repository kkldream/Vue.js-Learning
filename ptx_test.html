<head>
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
</head>

<body>
    <h3>取得憑證資料:</h3>
    <div id="accesstoken" class="align-text-bottom">
    </div>

    <h3>api 資料:</h3>
    <div id="apireponse" class="align-text-bottom">
    </div>
</body>

<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<!-- <script type="text/javascript" src="Sample.js"></script> -->
<script>
    $(function () {
        GetAuthorizationHeader();

        GetApiResponse();
    });

    function GetAuthorizationHeader() {
        const parameter = {
            grant_type: "client_credentials",
            client_id: "b0742033-ec2e35c5-abbc-4252",
            client_secret: "6e63241d-a57f-405e-9ce9-ebaab604ea6f"
        };

        let auth_url = "https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token";

        $.ajax({
            type: "POST",
            url: auth_url,
            crossDomain: true,
            dataType: 'JSON',
            data: parameter,
            async: false,
            success: function (data) {
                $("#accesstoken").text(JSON.stringify(data));
            },
            error: function (xhr, textStatus, thrownError) {

            }
        });
    }

    function GetApiResponse() {
        let accesstokenStr = $("#accesstoken").text();

        let accesstoken = JSON.parse(accesstokenStr);

        if (accesstoken != undefined) {
            $.ajax({
                type: 'GET',
                // 全找
                url: 'https://tdx.transportdata.tw/api/basic/v2/Bike/Station/Taipei?%24orderby=StationID%20asc&%24format=JSON',
                // 資訊篩選
                // url: 'https://tdx.transportdata.tw/api/basic/v2/Bike/Station/Taipei?%24select=StationName%2CStationPosition&%24orderby=StationID%20asc&%24format=JSON',
                // 資訊篩選+僅限2.0
                // url: 'https://tdx.transportdata.tw/api/basic/v2/Bike/Station/Taipei?%24select=StationName%2CStationPosition&%24filter=ServiceType%20eq%202&%24orderby=StationID%20asc&%24format=JSON',
                headers: {
                    "authorization": "Bearer " + accesstoken.access_token,
                },
                async: false,
                success: function (Data) {
                    $('#apireponse').text(JSON.stringify(Data));
                    console.log('Data', Data);
                },
                error: function (xhr, textStatus, thrownError) {
                    console.log('errorStatus:', textStatus);
                    console.log('Error:', thrownError);
                }
            });
        }
    }
</script>